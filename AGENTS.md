# AGENTS.md

## Project Overview

**AWS Bedrock AgentCore CDK Construct Library** - A multi-language CDK construct library for deploying AWS Bedrock AgentCore.

- Written in **TypeScript**, compiled to **Python, Java, C#, Go** via **jsii**
- Managed by **projen** - never edit generated files directly
- Published to **npm** and **PyPI**

## Setup Commands

```bash
npm install              # Install dependencies
npx projen              # Initialize/regenerate project files
npx projen build        # Build, test, and package
npx projen test         # Run tests only
npx projen package      # Package for all languages
```

## Project Structure

```
src/                    # TypeScript source (edit here)
  ├── index.ts         # Public API exports
  └── constructs/      # CDK construct implementations
test/                  # Test files
.projenrc.ts          # Project configuration (edit this, not package.json)
API.md                # Auto-generated API docs
package.json          # Generated by projen - DO NOT EDIT
```

## Critical Rules

### 1. jsii Compatibility is MANDATORY

All public APIs must be jsii-compatible to work across Python, Java, C#, and Go.

**❌ NEVER use:**
- Union types in public APIs: `string | number`
- Tuples: `[number, number]`
- Complex generics: `MyClass<T extends SomeType>`
- Type aliases for complex types

**✅ ALWAYS use:**
- Separate interfaces for different types
- Interfaces instead of tuples
- `readonly` for all properties
- Interfaces or classes for complex types

### 2. Projen File Management

**❌ NEVER edit:** `package.json`, `.gitignore`, `.github/workflows/*`, `tsconfig.json`, `.eslintrc.json`

**✅ ALWAYS edit:** `.projenrc.ts` then run `npx projen`

```typescript
// Example: Adding a dependency
const project = new awscdk.AwsCdkConstructLibrary({
  deps: ['existing-dep', 'new-package'],
});
```

### 3. Documentation Requirements

Every public API needs JSDoc with `@example`:

```typescript
/**
 * Creates an S3 bucket with best practices.
 * @example
 * new SecureBucket(this, 'MyBucket', { bucketName: 'my-bucket' });
 */
export class SecureBucket extends Construct { }
```

### 4. Testing Standards

Always include tests using `aws-cdk-lib/assertions`:

```typescript
import { Template } from 'aws-cdk-lib/assertions';

test('creates expected resources', () => {
  const template = Template.fromStack(stack);
  template.resourceCountIs('AWS::S3::Bucket', 1);
});
```

## Code Style

- TypeScript strict mode
- All properties must be `readonly`
- Use interfaces for props, not type aliases
- JSDoc required for all public APIs
- Follow CDK L2 construct patterns

**Property pattern:**
```typescript
export interface MyProps {
  /** @default - auto-generated */
  readonly name?: string;
  readonly vpcId: string;  // Required (no ?)
}
```

**Construct pattern:**
```typescript
export class MyConstruct extends Construct {
  public readonly resource: SomeResource;
  
  constructor(scope: Construct, id: string, props: MyProps = {}) {
    super(scope, id);
    // Apply defaults, create resources
  }
}
```

## Testing Instructions

- Tests required for all constructs
- Use `Template.fromStack()` for CloudFormation validation
- Run `npx projen test` before committing
- Minimum 80% code coverage

```bash
npx projen test                    # Run all tests
npx projen test -- -t "test name"  # Run specific test
```

## Python Module

TypeScript `camelCase` → Python `snake_case` (automatic)

```python
# TypeScript: myProperty
# Python: my_property
from simple_agentcore_runtime_patterns import SimpleAgentCoreRuntime

SimpleAgentCoreRuntime(stack, "MyAgent",
    agent_name="my-agent",  # camelCase → snake_case
)
```

## PR Instructions

- Run `npx projen build` before committing
- All tests must pass
- Update API.md if public APIs changed (auto-generated)
- Follow Conventional Commits: `feat:`, `fix:`, `chore:`

## Common Tasks

**Add dependency:**
```typescript
// Edit .projenrc.ts
deps: ['existing-dep', 'new-package']
// Then: npx projen
```

**Add target language:**
```typescript
// Edit .projenrc.ts
publishToMaven: { /* config */ }
// Then: npx projen
```

## Troubleshooting

**jsii errors:** Check for union types, tuples, or complex generics in public APIs. Run `npx jsii --diagnose`

**Projen issues:** Delete `package.json` and run `npx projen`

**Build failures:** Clean build with `rm -rf lib/ dist/ node_modules/ && npm install && npx projen build`

**Test failures:** Use `Template.fromStack(stack).toJSON()` to inspect CloudFormation output

## Security Considerations

- Never commit AWS credentials or secrets
- Use IAM roles and policies for permissions
- Follow AWS CDK security best practices
- Review generated CloudFormation templates for security issues

## Resources

- [AWS CDK Documentation](https://docs.aws.amazon.com/cdk/)
- [jsii Language Compatibility](https://aws.github.io/jsii/user-guides/language-support/)
- [projen Documentation](https://projen.io)
- [CDK Best Practices](https://github.com/aws/aws-cdk/blob/main/docs/DESIGN_GUIDELINES.md)
